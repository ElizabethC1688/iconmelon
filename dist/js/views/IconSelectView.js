(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("views/IconSelectView",["views/ProtoView","collectionViews/SectionsCollectionView","collections/SectionsCollection","collectionViews/FiltersCollectionView","collections/FiltersCollection","underscore","jquery","helpers"],function(e,n,r,i,s,o,u,a){var f,l;return f=function(e){function f(){return l=f.__super__.constructor.apply(this,arguments),l}return t(f,e),f.prototype.template="#icon-select-view-template",f.prototype.className="",f.prototype.events={keyup:"debouncedFilter","click #js-add-effects":"toggleEffects","click #js-next":"next","click #js-prev":"prev","click #js-page":"loadPage"},f.prototype.initialize=function(e){return this.o=e!=null?e:{},this.paginationTemplate=o.template(a.unescape(u("#pagination-template").text())),this.buttonCounterTemplate=o.template(a.unescape(u("#button-counter-template").text())),this.bindModelEvents(),this.debouncedFilter=o.debounce(this.filter,250),f.__super__.initialize.apply(this,arguments),this.sectionsCollection.on("sync",o.bind(this.renderPagination,this)),this},f.prototype.next=function(){var e=this;return this.scrollTop(),o.defer(function(){return e.sectionsCollection.nextPage()})},f.prototype.prev=function(){var e=this;return this.scrollTop(),o.defer(function(){return e.sectionsCollection.prevPage()})},f.prototype.scrollTop=function(){return App.$bodyHtml.animate({scrollTop:this.$el.position().top})},f.prototype.loadPage=function(e){return this.sectionsCollection.loadPage(parseInt(u(e.target).text(),10)||0)},f.prototype.toggleEffects=function(){return this.$("#js-filter-block").show().addClass("animated fadeInDown").find("#js-filters-place").trigger("show"),this.$el.addClass("is-filter-show")},f.prototype.filter=function(e){return App.vent.trigger("icon-select-filter:change",u.trim(u(e.target).val()))},f.prototype.bindModelEvents=function(){return this.model.on("change:selectedCounter",o.bind(this.renderButton,this))},f.prototype.render=function(){return f.__super__.render.apply(this,arguments),this.renderView(),this.$paginationPlace=this.$("#js-pagination-place"),this.initFileUpload(),this.renderButton(),this},f.prototype.renderPagination=function(){return this.$paginationPlace.html(this.paginationTemplate(this.sectionsCollection.pageInfo()))},f.prototype.renderView=function(){var e=this;return this.filtersCollectionView=new i({collection:new s,isRender:!0,$el:this.$("#js-filters-place")}),this.filtersCollectionView.collection.fetch(),this.sectionsCollection=new r,this.sectionsCollection.fetch().then(function(){return e.sectionsCollection.generateSvgData(),e.sectionsCollectionView=new n({collection:e.sectionsCollection,isRender:!0,$el:e.$("#js-section-collections-place")}),App.sectionsCollectionView=e.sectionsCollectionView,e.model.sectionsView=e.sectionsCollectionView}),this},f.prototype.renderButton=function(){return this.$(".icon-set-l").replaceWith(this.buttonCounterTemplate(this.model.toJSON()))},f.prototype.initFileUpload=function(){var e=this;return this.$("#fileupload").fileupload({url:"/file-upload",acceptFileTypes:/(\.|\/)(svg)$/i,dataType:"text",limitMultiFileUploads:999,add:function(t,n){return e.filesDropped=n.originalFiles.length,e.filesLoaded=0,n.submit()},done:function(t,n){return e.filesLoaded++,e.parseFile(n.result),e.filesLoaded===e.filesDropped&&e.finishFilesLoading()},error:function(e,t){return App.notifier.show({text:"loading error",type:"error"})},progressall:function(e,t){var n;return n=parseInt(t.loaded/t.total*100,10),App.$loadingLine.css({width:""+n+"%"})}})},f.prototype.finishFilesLoading=function(){var e=this;return setTimeout(function(){return App.$loadingLine.fadeOut(100,function(){return App.$loadingLine.width("0%"),App.$loadingLine.show()})},2e3)},f.prototype.parseFile=function(e){var t,n,r,i,s,o,u,a;r=e.match(/(data\-iconmelon\s?=\s?\")(.+?)\"/gi),i={};for(t=s=0,o=r.length;s<o;t=++s)n=r[t],n=n.split("data-iconmelon")[1].replace(/[\"\=]/gi,""),n=n.split(":"),(a=i[u=n[0]])==null&&(i[u]=[]),i[n[0]].push(n[1]);return this.checkLoadedIcons(i)},f.prototype.checkLoadedIcons=function(e){var t,n,r,i,s,o,u,a,f;f=[];for(a in e)i=e[a],a!=="filter"?(u=this.sectionsCollectionView.collection.where({name:a}),f.push(function(){var e,t,a;a=[];for(n=e=0,t=u.length;e<t;n=++e)o=u[n],a.push(function(){var e,t,n;n=[];for(s=e=0,t=i.length;e<t;s=++e)r=i[s],r=o.iconsCollection.where({hash:r})[0],n.push(r.set("isSelected",!0));return n}());return a}())):f.push(function(){var e,r,s;s=[];for(n=e=0,r=i.length;e<r;n=++e)t=i[n],s.push(this.filtersCollectionView.collection.where({hash:t})[0].set("isSelected",!0));return s}.call(this));return f},f}(e),f})}).call(this);